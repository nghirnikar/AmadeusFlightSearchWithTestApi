<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Review & Book</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="container">
  <h2>Review & Book</h2>
  <div id="offerBox"></div>

  <h3>Passenger Details</h3>
  <form id="paxForm">
    <input id="firstName" placeholder="First name" required />
    <input id="lastName" placeholder="Last name" required />
    <input id="email" type="email" placeholder="Email" required />
    <input id="dob" type="date" placeholder="Date of Birth" />
    <button type="submit">Book Flight</button>
  </form>

  <p id="msg"></p>

  <h3>Cancel Booking</h3>
  <input id="orderId" placeholder="Enter Order ID" />
  <button id="cancelBtn">Cancel</button>
  <p id="cancelMsg"></p>
</div>

<script>
const API = "https://amadeus-proxy.nikhilcloudonline.workers.dev"; // Your Cloudflare Worker

let offer;

document.addEventListener("DOMContentLoaded", async () => {
  offer = JSON.parse(localStorage.getItem("selectedOffer"));
  if (!offer) {
    document.getElementById("offerBox").innerText = "❌ No offer found!";
    return;
  }

  document.getElementById("offerBox").innerText = "Checking fare...";
  const priced = await fetch(API + "/api/price", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ offer })
  }).then(r => r.json());

  const finalOffer = priced.data?.flightOffers?.[0] || offer;
  localStorage.setItem("finalOffer", JSON.stringify(finalOffer));

  document.getElementById("offerBox").innerHTML = `
    <p>✅ Fare confirmed</p>
    <p><strong>Total:</strong> ${finalOffer.price.total} ${finalOffer.price.currency}</p>
  `;

  // BOOK
  document.getElementById("paxForm").addEventListener("submit", async e => {
    e.preventDefault();
    const pax = {
      firstName: firstName.value,
      lastName: lastName.value,
      email: email.value,
      dob:
